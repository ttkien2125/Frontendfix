\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{vietnam}
\usepackage{tikz}
\usetikzlibrary{shapes.geometric, arrows.meta, positioning, fit, backgrounds}
\usepackage{geometry}
\usepackage{xcolor}

\geometry{a4paper, margin=1.5cm}

% Define colors
\definecolor{yellowbox}{RGB}{254, 249, 195}
\definecolor{lightred}{RGB}{254, 226, 226}
\definecolor{blueheader}{RGB}{37, 99, 235}

% Define styles matching the reference image
\tikzstyle{screen} = [rectangle, rounded corners=3pt, minimum width=3.5cm, minimum height=1cm, text centered, draw=red!70!black, fill=yellowbox, thick, text width=3.2cm, font=\small]
\tikzstyle{mainscreen} = [rectangle, rounded corners=3pt, minimum width=4cm, minimum height=1.2cm, text centered, draw=red!70!black, fill=yellowbox, thick, text width=3.8cm]
\tikzstyle{legend} = [rectangle, rounded corners=3pt, draw=red!80!black, thick, fill=lightred, text width=3cm, font=\small]
\tikzstyle{arrow} = [thick,->,>=Stealth,draw=red!70!black]
\tikzstyle{biarrow} = [thick,<->,>=Stealth,draw=red!70!black]
\tikzstyle{connector} = [thick,-,draw=red!70!black]

\begin{document}

\begin{figure}[p]
\centering
\begin{tikzpicture}[node distance=1.2cm, auto]

% Top - Login Screen
\node[mainscreen] (login) at (6, 12) {Màn hình đăng nhập};

% Role branches
\node[screen] (resident) at (1, 10) {Trường tên người dùng};
\node[screen] (password) at (5, 10) {Phím mật khẩu};
\node[screen] (role) at (9, 10) {Phím để tránh};
\node[screen] (delete) at (11, 10) {Phím xóa};

% Main authenticated screen
\node[mainscreen] (main) at (6, 7.5) {Màn hình chính độc giả};

% Left side - Search and filter
\node[screen] (search) at (1, 6) {Phím tìm kiếm};
\node[screen] (callback) at (1, 4.5) {Phím gọi ý};
\node[screen] (exit) at (1, 3) {Phím thoát};

% Bottom - Main function screens
\node[screen] (search-data) at (3, 2) {Màn hình tìm kiếm\\dữ liệu};
\node[screen] (callback-screen) at (6, 2) {Màn hình gọi ý};

% Result screens
\node[screen] (result) at (4.5, -0.5) {Màn hình kết quả};
\node[screen] (order) at (9, -0.5) {Màn hình đặt trước};

% Bottom detail screens
\node[screen] (booklist) at (3, -3) {Màn hình danh sách\\sách};
\node[screen] (order-btn) at (6.5, -3) {Phím đặt trước};

% Final screens
\node[screen] (update) at (5, -5.5) {Cửa sổ đặt trước};
\node[screen] (recommendation) at (9, -5.5) {Phím đề trình};

% Legend box
\node[legend] (legend) at (0.5, -3) {
    \textbf{Chú thích:}\\[0.1cm]
    Tác giả\\
    Loại\\
    Tên tài liệu\\
    Số tập chỉ\\
    Chữa trường:\\
    Chửa phim:\\
    Để trình\\
    Xóa
};

% Arrows from login to fields
\draw[arrow] (login) -- (resident);
\draw[arrow] (login) -- (password);
\draw[arrow] (login) -- (role);
\draw[arrow] (login) -- (delete);

% Arrow from login to main screen
\draw[arrow] (login) -- (main);

% Arrows from left menu
\draw[connector] (search) -- (3, 6);
\draw[arrow] (3, 6) -- (main);
\draw[connector] (callback) -- (3, 4.5);
\draw[arrow] (3, 4.5) -- (main);
\draw[connector] (exit) -- (3, 3);
\draw[arrow] (3, 3) -- (main);

% Arrows from main to bottom screens
\draw[arrow] (main) -- (search-data);
\draw[arrow] (main) -- (callback-screen);

% Arrows to result screen
\draw[arrow] (search-data) -- (result);
\draw[arrow] (callback-screen) -- (result);

% Arrow to order screen
\draw[arrow] (result) -- (order);

% Arrows from result to bottom screens
\draw[arrow] (result) -- (booklist);
\draw[arrow] (result) -- (order-btn);

% Arrows to final screens
\draw[arrow] (booklist) -- (update);
\draw[arrow] (order-btn) -- (update);
\draw[arrow] (order) -- (recommendation);

% Double-headed arrows within main screen
\draw[biarrow] (main.south) to[out=270, in=90] (4, 5.5);
\draw[biarrow] (main.south) to[out=270, in=90] (8, 5.5);

\end{tikzpicture}

\caption{Sơ đồ màn hình hệ thống quản lý tòa nhà BlueMoon}
\label{fig:screen-flow}
\end{figure}

\end{document}
